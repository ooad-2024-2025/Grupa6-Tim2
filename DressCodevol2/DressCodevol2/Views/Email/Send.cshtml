@model DressCode.Models.SendEmailViewModel
@{
    ViewData["Title"] = "Pošalji Email";
}

<h2>@ViewData["Title"]</h2>

@if (ViewBag.Success != null)
{
    <div class="alert alert-success">@ViewBag.Success</div>
}

<form asp-action="Send" method="post" id="emailForm" novalidate>
    <!-- dodano novalidate zbog ostalih polja -->
    <div asp-validation-summary="ModelOnly" class="text-danger"></div>

    <div class="mb-3" id="email-group">
        <label for="Email" class="form-label">Email adresa</label>
        <input type="email"
               name="Email"
               id="Email"
               class="form-control" />
        <span asp-validation-for="Email" class="text-danger"></span>
    </div>

    <div class="form-check mb-3">
        <input type="hidden" name="SendToAll" value="false" />
        <input type="checkbox"
               name="SendToAll"
               id="SendToAll"
               value="true"
               class="form-check-input"
               @(Model.SendToAll ? "checked" : "") />
        <label for="SendToAll" class="form-check-label">
            Pošalji svim Loyalty korisnicima
        </label>
    </div>

    <div class="mb-3">
        <label asp-for="Subject" class="form-label"></label>
        <input asp-for="Subject" class="form-control" />
        <span asp-validation-for="Subject" class="text-danger"></span>
    </div>

    <div class="mb-3">
        <label asp-for="Message" class="form-label"></label>
        <textarea asp-for="Message" class="form-control" rows="5"></textarea>
        <span asp-validation-for="Message" class="text-danger"></span>
    </div>

    <button type="submit" class="btn btn-primary">Pošalji Email</button>
</form>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(function () {
            function toggle() {
                if ($("#SendToAll").prop("checked")) {
                    $("#email-group").remove(); // potpuno uklanja email input
                } else {
                    if ($("#email-group").length === 0) {
                        $("#emailForm .form-check").before(`
                            <div class="mb-3" id="email-group">
                                <label for="Email" class="form-label">Email adresa</label>
                                <input type="email" name="Email" id="Email" class="form-control" />
                                <span class="text-danger field-validation-valid" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                            </div>
                        `);
                    }
                }
            }
            toggle();
            $("#SendToAll").change(toggle);
        });
    </script>
}
