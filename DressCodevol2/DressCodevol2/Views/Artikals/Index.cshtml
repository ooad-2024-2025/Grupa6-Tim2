@model IEnumerable<DressCode.Models.Artikal>
@{
    ViewData["Title"] = "Lista artikala";
    var currentSort = ViewData["CurrentSort"]?.ToString();
    var currentMaterijal = ViewData["CurrentMaterijal"]?.ToString();
    var hasActiveFilters = !string.IsNullOrEmpty(currentMaterijal) ||
                          ViewData["CurrentKategorija"] != null ||
                          ViewData["CurrentSpol"] != null ||
                          ViewData["CurrentVelicina"] != null;
}

<h1>Lista artikala</h1>

<p>
    <a asp-action="Create" class="btn btn-success">Dodaj novi artikal</a>
</p>

<!-- Filter i sortiranje forma -->
<div class="card mb-4">
    <div class="card-header">
        <h5 class="card-title mb-0">Filtriranje i sortiranje</h5>
    </div>
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-2">
                <label class="form-label">Kategorija:</label>
                <select name="kategorijaFilter" class="form-select" asp-items="@((SelectList)ViewData["Kategorije"])">
                    <option value="">Sve kategorije</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label">Spol:</label>
                <select name="spolFilter" class="form-select" asp-items="@((SelectList)ViewData["Spolovi"])">
                    <option value="">Svi spolovi</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label">Veličina:</label>
                <select name="velicinaFilter" class="form-select" asp-items="@((SelectList)ViewData["Velicine"])">
                    <option value="">Sve veličine</option>
                </select>
            </div>

            <div class="col-md-2">
                <label class="form-label">Materijal:</label>
                <input type="text" name="materijal" class="form-control"
                       value="@currentMaterijal"
                       placeholder="Pretraži materijal">
            </div>

            <div class="col-md-2">
                <label class="form-label">Sortiranje:</label>
                <select name="sortOrder" class="form-select">
                    <option value="">Zadano</option>
                    @if (currentSort == "cijena_asc")
                    {
                        <option value="cijena_asc" selected>Cijena (rastuce)</option>
                        <option value="cijena_desc">Cijena (opadajuce)</option>
                    }
                    else if (currentSort == "cijena_desc")
                    {
                        <option value="cijena_asc">Cijena (rastuce)</option>
                        <option value="cijena_desc" selected>Cijena (opadajuce)</option>
                    }
                    else
                    {
                        <option value="cijena_asc">Cijena (rastuce)</option>
                        <option value="cijena_desc">Cijena (opadajuce)</option>
                    }
                </select>
            </div>

            <div class="col-md-2 d-flex align-items-end">
                <button type="submit" class="btn btn-primary me-2">
                    <i class="fas fa-search"></i> Filtriraj
                </button>
                <a asp-action="Index" class="btn btn-secondary">
                    <i class="fas fa-undo"></i> Resetuj
                </a>
            </div>
        </form>
    </div>
</div>

<!-- Rezultati -->
<div class="row mb-3">
    <div class="col-md-6">
        <p class="text-muted">Pronađeno: <strong>@Model.Count()</strong> artikala</p>
    </div>
    <div class="col-md-6 text-end">
        @if (hasActiveFilters)
        {
            <span class="badge bg-info">Filtri aktivni</span>
        }
    </div>
</div>

@if (Model.Any())
{
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Kategorija</th>
                    <th>
                        <a asp-action="Index"
                           asp-route-sortOrder="@ViewData["CijenaAscSortParm"]"
                           asp-route-kategorijaFilter="@ViewData["CurrentKategorija"]"
                           asp-route-spolFilter="@ViewData["CurrentSpol"]"
                           asp-route-velicinaFilter="@ViewData["CurrentVelicina"]"
                           asp-route-materijal="@ViewData["CurrentMaterijal"]"
                           class="text-white text-decoration-none">
                            Cijena
                            @if (currentSort == "cijena_asc")
                            {
                                <i class="fas fa-sort-up"></i>
                            }
                            else if (currentSort == "cijena_desc")
                            {
                                <i class="fas fa-sort-down"></i>
                            }
                            else
                            {
                                <i class="fas fa-sort"></i>
                            }
                        </a>
                    </th>
                    <th>Materijal</th>
                    <th>Veličina</th>
                    <th>Spol</th>
                    <th>Opis</th>
                    <th width="200">Akcije</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <span class="badge bg-secondary">
                                @(item.Kategorija?.Naziv ?? "N/A")
                            </span>
                        </td>
                        <td>
                            <strong>@item.Cijena.ToString("0.00") KM</strong>
                        </td>
                        <td>@item.Materijal</td>
                        <td>
                            <span class="badge bg-info">@item.Velicina</span>
                        </td>
                        <td>
                            @if (item.Spol.ToString() == "Muski")
                            {
                                <span class="badge bg-primary">@item.Spol</span>
                            }
                            else
                            {
                                <span class="badge bg-pink">@item.Spol</span>
                            }
                        </td>
                        <td>
                            @if (item.Opis.Length > 50)
                            {
                                <span title="@item.Opis">@item.Opis.Substring(0, 50)...</span>
                            }
                            else
                            {
                                <span>@item.Opis</span>
                            }
                        </td>
                        <td>
                            <div class="btn-group-vertical btn-group-sm" role="group">
                                <a asp-action="Edit" asp-route-id="@item.Id"
                                   class="btn btn-outline-warning btn-sm">
                                    <i class="fas fa-edit"></i> Edit
                                </a>
                                <a asp-action="Details" asp-route-id="@item.Id"
                                   class="btn btn-outline-info btn-sm">
                                    <i class="fas fa-eye"></i> Details
                                </a>
                                <a asp-action="Delete" asp-route-id="@item.Id"
                                   class="btn btn-outline-danger btn-sm">
                                    <i class="fas fa-trash"></i> Delete
                                </a>
                            </div>
                            <form asp-action="DodajUKorpu" asp-route-id="@item.Id"
                                  method="post" class="mt-2">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-outline-primary btn-sm w-100">
                                    <i class="fas fa-shopping-cart"></i> Dodaj u korpu
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
}
else
{
    <div class="alert alert-info text-center">
        <i class="fas fa-info-circle fa-2x mb-3"></i>
        <h4>Nema artikala</h4>
        <p>Nema artikala koji odgovaraju zadatim kriterijumima.</p>
        <a asp-action="Index" class="btn btn-primary">Prikaži sve artikle</a>
    </div>
}

<!-- Dodaj neki CSS za bg-pink ako ga nema -->
<style>
    .bg-pink {
        background-color: #e83e8c !important;
        color: white;
    }

    .table th a {
        color: inherit;
    }

        .table th a:hover {
            color: #ffc107;
        }

    .btn-group-vertical .btn {
        margin-bottom: 2px;
    }

    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid #dee2e6;
    }
</style>